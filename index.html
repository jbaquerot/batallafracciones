<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ Batalla de Fracciones</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: white;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            text-align: center;
            color: #f0e6ff;
            margin-bottom: 20px;
            font-size: 1.1em;
        }

        /* Pantalla de inicio */
        .start-screen {
            background: white;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .start-screen h2 {
            color: #764ba2;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .start-screen p {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .rules-box {
            background: #f8f4ff;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
        }

        .rules-box h3 {
            color: #764ba2;
            margin-bottom: 10px;
        }

        .rules-box ul {
            color: #555;
            margin-left: 20px;
        }

        .rules-box li {
            margin-bottom: 8px;
        }

        .player-setup {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .player-input {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .player-input label {
            color: #764ba2;
            font-weight: bold;
        }

        .player-input input {
            padding: 10px 15px;
            border: 2px solid #e0d4f7;
            border-radius: 10px;
            font-size: 1em;
            text-align: center;
            width: 150px;
        }

        .player-input input:focus {
            outline: none;
            border-color: #764ba2;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2em;
            border-radius: 30px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-top: 20px;
        }

        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        /* Pantalla de juego */
        .game-screen {
            display: none;
        }

        .game-header {
            background: white;
            border-radius: 15px;
            padding: 15px 25px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .round-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .round-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
        }

        .objective {
            background: #fff3e0;
            padding: 10px 20px;
            border-radius: 10px;
            border: 2px solid #ffb74d;
        }

        .objective-label {
            color: #e65100;
            font-weight: bold;
            font-size: 0.9em;
        }

        .objective-value {
            color: #e65100;
            font-size: 1.5em;
            font-weight: bold;
        }

        .scores {
            display: flex;
            gap: 20px;
        }

        .score {
            text-align: center;
            padding: 5px 15px;
            background: #f5f5f5;
            border-radius: 10px;
        }

        .score-name {
            font-size: 0.8em;
            color: #666;
        }

        .score-value {
            font-size: 1.3em;
            font-weight: bold;
            color: #764ba2;
        }

        /* √Årea de jugadores */
        .players-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 700px) {
            .players-area {
                grid-template-columns: 1fr;
            }
        }

        .player-section {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .player-section.active {
            transform: scale(1.02);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
            border: 3px solid #667eea;
        }

        .player-section.waiting {
            opacity: 0.7;
        }

        .player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .player-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #764ba2;
        }

        .player-turn {
            background: #4caf50;
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.85em;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .cards-hand {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 15px;
            min-height: 100px;
        }

        .card {
            width: 60px;
            height: 85px;
            background: linear-gradient(145deg, #fff 0%, #f5f5f5 100%);
            border: 2px solid #ddd;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8em;
            font-weight: bold;
            color: #333;
            cursor: pointer;
            transition: transform 0.2s, border-color 0.2s, box-shadow 0.2s;
            user-select: none;
        }

        .card:hover:not(.disabled) {
            transform: translateY(-5px);
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .card.selected-num {
            background: linear-gradient(145deg, #e3f2fd 0%, #bbdefb 100%);
            border-color: #2196f3;
            transform: translateY(-10px);
            box-shadow: 0 8px 20px rgba(33, 150, 243, 0.3);
        }

        .card.selected-den {
            background: linear-gradient(145deg, #fce4ec 0%, #f8bbd9 100%);
            border-color: #e91e63;
            transform: translateY(-10px);
            box-shadow: 0 8px 20px rgba(233, 30, 99, 0.3);
        }

        .card.disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .card.hidden {
            background: linear-gradient(145deg, #764ba2 0%, #667eea 100%);
            color: transparent;
            cursor: default;
        }

        .card.hidden::after {
            content: "?";
            color: white;
            font-size: 1.5em;
        }

        .selection-area {
            background: #f8f4ff;
            border-radius: 15px;
            padding: 15px;
            text-align: center;
        }

        .selection-label {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .fraction-display {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .fraction-box {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .fraction-num, .fraction-den {
            width: 50px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
            border-radius: 8px;
        }

        .fraction-num {
            background: #e3f2fd;
            color: #2196f3;
            border: 2px dashed #2196f3;
        }

        .fraction-num.filled {
            border-style: solid;
        }

        .fraction-line {
            width: 50px;
            height: 3px;
            background: #333;
            margin: 3px 0;
        }

        .fraction-den {
            background: #fce4ec;
            color: #e91e63;
            border: 2px dashed #e91e63;
        }

        .fraction-den.filled {
            border-style: solid;
        }

        .fraction-equals {
            font-size: 1.5em;
            color: #666;
            margin: 0 10px;
        }

        .fraction-decimal {
            font-size: 1.8em;
            font-weight: bold;
            color: #764ba2;
            min-width: 60px;
        }

        .selection-help {
            margin-top: 10px;
            font-size: 0.85em;
            color: #888;
        }

        .selection-help span {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 5px;
            margin: 0 3px;
        }

        .help-num {
            background: #e3f2fd;
            color: #2196f3;
        }

        .help-den {
            background: #fce4ec;
            color: #e91e63;
        }

        /* Botones de acci√≥n */
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        .btn-confirm {
            background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%);
        }

        .btn-clear {
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
        }

        .btn-small {
            padding: 10px 25px;
            font-size: 1em;
        }

        /* Resultados de ronda */
        .round-result {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .round-result h2 {
            color: #764ba2;
            margin-bottom: 20px;
        }

        .result-comparison {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .result-player {
            padding: 20px;
            border-radius: 15px;
            min-width: 150px;
        }

        .result-player.winner {
            background: linear-gradient(135deg, #fff9c4 0%, #fff59d 100%);
            border: 3px solid #ffd54f;
        }

        .result-player.loser {
            background: #f5f5f5;
        }

        .result-player.tie {
            background: linear-gradient(135deg, #e1f5fe 0%, #b3e5fc 100%);
            border: 3px solid #4fc3f7;
        }

        .result-player-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .result-fraction {
            font-size: 1.5em;
            color: #764ba2;
            margin-bottom: 5px;
        }

        .result-decimal {
            color: #666;
        }

        .result-distance {
            font-size: 0.9em;
            color: #888;
            margin-top: 5px;
        }

        .winner-announcement {
            font-size: 1.5em;
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
        }

        .winner-announcement.win {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .winner-announcement.tie {
            background: #e3f2fd;
            color: #1565c0;
        }

        .cards-won {
            color: #ff9800;
            font-size: 1.1em;
            margin-bottom: 20px;
        }

        /* Pantalla final */
        .final-screen {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .trophy {
            font-size: 5em;
            margin-bottom: 20px;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .final-screen h2 {
            color: #764ba2;
            font-size: 2em;
            margin-bottom: 10px;
        }

        .final-winner {
            font-size: 2.5em;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .final-scores {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin: 30px 0;
        }

        .final-score-box {
            padding: 20px 30px;
            border-radius: 15px;
            background: #f5f5f5;
        }

        .final-score-box.winner {
            background: linear-gradient(135deg, #fff9c4 0%, #fff59d 100%);
            border: 3px solid #ffd54f;
        }

        .final-score-name {
            font-size: 1.2em;
            color: #333;
            margin-bottom: 10px;
        }

        .final-score-cards {
            font-size: 2.5em;
            font-weight: bold;
            color: #764ba2;
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            top: -10px;
            animation: fall linear forwards;
        }

        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(720deg);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ Batalla de Fracciones</h1>
        <p class="subtitle">¬°Demuestra qui√©n es el mejor con las fracciones!</p>

        <!-- Pantalla de inicio -->
        <div class="start-screen" id="startScreen">
            <h2>¬°Bienvenida al juego!</h2>
            <p>Compite para conseguir fracciones lo m√°s cercanas posible al objetivo de cada ronda.</p>

            <div class="rules-box">
                <h3>üìú Reglas del juego</h3>
                <ul>
                    <li>Cada jugador recibe <strong>5 cartas</strong> al inicio.</li>
                    <li>En cada ronda hay un <strong>objetivo</strong> (acercarse a un n√∫mero).</li>
                    <li>Elige <strong>2 cartas</strong> para formar tu fracci√≥n (numerador/denominador).</li>
                    <li>¬°Quien m√°s se acerque al objetivo <strong>gana las cartas</strong> de la ronda!</li>
                    <li>Despu√©s de 5 rondas, <strong>gana quien tenga m√°s cartas</strong>.</li>
                </ul>
            </div>

            <div class="player-setup">
                <div class="player-input">
                    <label>üëß Jugador 1</label>
                    <input type="text" id="player1Name" placeholder="Tu nombre" value="Jugadora 1">
                </div>
                <div class="player-input">
                    <label>üßë Jugador 2</label>
                    <input type="text" id="player2Name" placeholder="Su nombre" value="Jugador 2">
                </div>
            </div>

            <button class="btn" onclick="startGame()">üöÄ ¬°Empezar a jugar!</button>
        </div>

        <!-- Pantalla de juego -->
        <div class="game-screen" id="gameScreen">
            <div class="game-header">
                <div class="round-info">
                    <div class="round-badge">Ronda <span id="currentRound">1</span>/5</div>
                    <div class="objective">
                        <div class="objective-label">üéØ Objetivo: acercarse a</div>
                        <div class="objective-value" id="objectiveValue">1</div>
                    </div>
                </div>
                <div class="scores">
                    <div class="score">
                        <div class="score-name" id="score1Name">Jugador 1</div>
                        <div class="score-value"><span id="score1">0</span> üÉè</div>
                    </div>
                    <div class="score">
                        <div class="score-name" id="score2Name">Jugador 2</div>
                        <div class="score-value"><span id="score2">0</span> üÉè</div>
                    </div>
                </div>
            </div>

            <div class="players-area">
                <!-- Jugador 1 -->
                <div class="player-section" id="player1Section">
                    <div class="player-header">
                        <div class="player-name" id="player1Label">Jugador 1</div>
                        <div class="player-turn" id="turn1" style="display: none;">¬°Tu turno!</div>
                    </div>
                    <div class="cards-hand" id="hand1"></div>
                    <div class="selection-area">
                        <div class="selection-label">Tu fracci√≥n:</div>
                        <div class="fraction-display">
                            <div class="fraction-box">
                                <div class="fraction-num" id="num1">?</div>
                                <div class="fraction-line"></div>
                                <div class="fraction-den" id="den1">?</div>
                            </div>
                            <div class="fraction-equals">=</div>
                            <div class="fraction-decimal" id="decimal1">-</div>
                        </div>
                        <div class="selection-help">
                            <span class="help-num">1er clic = arriba</span>
                            <span class="help-den">2do clic = abajo</span>
                        </div>
                    </div>
                </div>

                <!-- Jugador 2 -->
                <div class="player-section" id="player2Section">
                    <div class="player-header">
                        <div class="player-name" id="player2Label">Jugador 2</div>
                        <div class="player-turn" id="turn2" style="display: none;">¬°Tu turno!</div>
                    </div>
                    <div class="cards-hand" id="hand2"></div>
                    <div class="selection-area">
                        <div class="selection-label">Tu fracci√≥n:</div>
                        <div class="fraction-display">
                            <div class="fraction-box">
                                <div class="fraction-num" id="num2">?</div>
                                <div class="fraction-line"></div>
                                <div class="fraction-den" id="den2">?</div>
                            </div>
                            <div class="fraction-equals">=</div>
                            <div class="fraction-decimal" id="decimal2">-</div>
                        </div>
                        <div class="selection-help">
                            <span class="help-num">1er clic = arriba</span>
                            <span class="help-den">2do clic = abajo</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-small btn-clear" onclick="clearSelection()">üîÑ Borrar selecci√≥n</button>
                <button class="btn btn-small btn-confirm" id="confirmBtn" onclick="confirmSelection()" disabled>‚úÖ Confirmar</button>
            </div>
        </div>

        <!-- Resultado de ronda -->
        <div class="round-result" id="roundResult">
            <h2>üé≤ Resultado de la ronda</h2>
            <div class="result-comparison" id="resultComparison"></div>
            <div class="winner-announcement" id="winnerAnnouncement"></div>
            <div class="cards-won" id="cardsWon"></div>
            <button class="btn" id="nextRoundBtn" onclick="nextRound()">‚û°Ô∏è Siguiente ronda</button>
        </div>

        <!-- Pantalla final -->
        <div class="final-screen" id="finalScreen">
            <div class="trophy">üèÜ</div>
            <h2>¬°Fin del juego!</h2>
            <div class="final-winner" id="finalWinner"></div>
            <div class="final-scores" id="finalScores"></div>
            <button class="btn" onclick="restartGame()">üîÑ Jugar de nuevo</button>
        </div>
    </div>

    <script>
        // Estado del juego
        let gameState = {
            players: ['Jugador 1', 'Jugador 2'],
            hands: [[], []],
            scores: [0, 0],
            currentRound: 1,
            currentPlayer: 0,
            selections: [
                { num: null, den: null, numIndex: null, denIndex: null },
                { num: null, den: null, numIndex: null, denIndex: null }
            ],
            deck: [],
            objectives: [1, 0, 0.5, 0.75, 0.333],
            objectiveLabels: ['1', '0', '¬Ω', '¬æ', '‚Öì'],
            roundsPlayed: 0
        };

        // Crear baraja (cartas del 1 al 9)
        function createDeck() {
            let deck = [];
            for (let i = 1; i <= 9; i++) {
                // 4 copias de cada carta (como una baraja espa√±ola)
                for (let j = 0; j < 4; j++) {
                    deck.push(i);
                }
            }
            return shuffleDeck(deck);
        }

        // Barajar
        function shuffleDeck(deck) {
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
            return deck;
        }

        // Repartir cartas
        function dealCards(count) {
            let cards = [];
            for (let i = 0; i < count && gameState.deck.length > 0; i++) {
                cards.push(gameState.deck.pop());
            }
            return cards;
        }

        // Iniciar juego
        function startGame() {
            gameState.players[0] = document.getElementById('player1Name').value || 'Jugador 1';
            gameState.players[1] = document.getElementById('player2Name').value || 'Jugador 2';

            gameState.deck = createDeck();
            gameState.hands[0] = dealCards(5);
            gameState.hands[1] = dealCards(5);
            gameState.scores = [0, 0];
            gameState.currentRound = 1;
            gameState.currentPlayer = 0;
            gameState.roundsPlayed = 0;
            resetSelections();

            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'block';
            document.getElementById('roundResult').style.display = 'none';
            document.getElementById('finalScreen').style.display = 'none';

            updateUI();
        }

        // Reiniciar selecciones
        function resetSelections() {
            gameState.selections = [
                { num: null, den: null, numIndex: null, denIndex: null },
                { num: null, den: null, numIndex: null, denIndex: null }
            ];
        }

        // Actualizar interfaz
        function updateUI() {
            // Nombres
            document.getElementById('player1Label').textContent = gameState.players[0];
            document.getElementById('player2Label').textContent = gameState.players[1];
            document.getElementById('score1Name').textContent = gameState.players[0];
            document.getElementById('score2Name').textContent = gameState.players[1];

            // Ronda y objetivo
            document.getElementById('currentRound').textContent = gameState.currentRound;
            document.getElementById('objectiveValue').textContent = gameState.objectiveLabels[gameState.currentRound - 1];

            // Puntuaciones
            document.getElementById('score1').textContent = gameState.scores[0];
            document.getElementById('score2').textContent = gameState.scores[1];

            // Renderizar manos
            renderHand(0);
            renderHand(1);

            // Actualizar turno visual
            updateTurnIndicator();

            // Actualizar fracciones mostradas
            updateFractionDisplay(0);
            updateFractionDisplay(1);

            // Bot√≥n confirmar
            updateConfirmButton();
        }

        // Renderizar mano de un jugador
        function renderHand(playerIndex) {
            const handEl = document.getElementById(`hand${playerIndex + 1}`);
            const hand = gameState.hands[playerIndex];
            const selection = gameState.selections[playerIndex];
            const isActive = gameState.currentPlayer === playerIndex;
            const otherPlayerDone = gameState.selections[1 - playerIndex].num !== null &&
                                    gameState.selections[1 - playerIndex].den !== null;

            handEl.innerHTML = '';

            hand.forEach((card, index) => {
                const cardEl = document.createElement('div');
                cardEl.className = 'card';

                // Si no es el turno del jugador y el otro no ha terminado, ocultar cartas
                if (!isActive && !otherPlayerDone && gameState.selections[playerIndex].num === null) {
                    cardEl.classList.add('hidden');
                } else {
                    cardEl.textContent = card;

                    if (index === selection.numIndex) {
                        cardEl.classList.add('selected-num');
                    } else if (index === selection.denIndex) {
                        cardEl.classList.add('selected-den');
                    }

                    if (isActive) {
                        cardEl.onclick = () => selectCard(playerIndex, index);
                    } else {
                        cardEl.classList.add('disabled');
                    }
                }

                handEl.appendChild(cardEl);
            });
        }

        // Seleccionar carta
        function selectCard(playerIndex, cardIndex) {
            if (gameState.currentPlayer !== playerIndex) return;

            const selection = gameState.selections[playerIndex];
            const card = gameState.hands[playerIndex][cardIndex];

            // Si la carta ya est√° seleccionada, deseleccionarla
            if (selection.numIndex === cardIndex) {
                selection.num = null;
                selection.numIndex = null;
            } else if (selection.denIndex === cardIndex) {
                selection.den = null;
                selection.denIndex = null;
            } else {
                // Seleccionar como numerador o denominador
                if (selection.num === null) {
                    selection.num = card;
                    selection.numIndex = cardIndex;
                } else if (selection.den === null) {
                    selection.den = card;
                    selection.denIndex = cardIndex;
                } else {
                    // Ambos seleccionados, reemplazar denominador
                    selection.den = card;
                    selection.denIndex = cardIndex;
                }
            }

            updateUI();
        }

        // Actualizar indicador de turno
        function updateTurnIndicator() {
            const section1 = document.getElementById('player1Section');
            const section2 = document.getElementById('player2Section');
            const turn1 = document.getElementById('turn1');
            const turn2 = document.getElementById('turn2');

            section1.classList.remove('active', 'waiting');
            section2.classList.remove('active', 'waiting');
            turn1.style.display = 'none';
            turn2.style.display = 'none';

            if (gameState.currentPlayer === 0) {
                section1.classList.add('active');
                section2.classList.add('waiting');
                turn1.style.display = 'block';
            } else {
                section2.classList.add('active');
                section1.classList.add('waiting');
                turn2.style.display = 'block';
            }
        }

        // Actualizar display de fracci√≥n
        function updateFractionDisplay(playerIndex) {
            const selection = gameState.selections[playerIndex];
            const numEl = document.getElementById(`num${playerIndex + 1}`);
            const denEl = document.getElementById(`den${playerIndex + 1}`);
            const decimalEl = document.getElementById(`decimal${playerIndex + 1}`);

            if (selection.num !== null) {
                numEl.textContent = selection.num;
                numEl.classList.add('filled');
            } else {
                numEl.textContent = '?';
                numEl.classList.remove('filled');
            }

            if (selection.den !== null) {
                denEl.textContent = selection.den;
                denEl.classList.add('filled');
            } else {
                denEl.textContent = '?';
                denEl.classList.remove('filled');
            }

            if (selection.num !== null && selection.den !== null && selection.den !== 0) {
                const value = selection.num / selection.den;
                decimalEl.textContent = value.toFixed(3);
            } else {
                decimalEl.textContent = '-';
            }
        }

        // Actualizar bot√≥n confirmar
        function updateConfirmButton() {
            const selection = gameState.selections[gameState.currentPlayer];
            const btn = document.getElementById('confirmBtn');
            btn.disabled = !(selection.num !== null && selection.den !== null && selection.den !== 0);
        }

        // Limpiar selecci√≥n
        function clearSelection() {
            const playerIndex = gameState.currentPlayer;
            gameState.selections[playerIndex] = { num: null, den: null, numIndex: null, denIndex: null };
            updateUI();
        }

        // Confirmar selecci√≥n
        function confirmSelection() {
            const selection = gameState.selections[gameState.currentPlayer];
            if (selection.num === null || selection.den === null) return;

            if (gameState.currentPlayer === 0) {
                // Pasa al jugador 2
                gameState.currentPlayer = 1;
                updateUI();
            } else {
                // Ambos han jugado, mostrar resultado
                showRoundResult();
            }
        }

        // Mostrar resultado de ronda
        function showRoundResult() {
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('roundResult').style.display = 'block';

            const objective = gameState.objectives[gameState.currentRound - 1];
            const sel1 = gameState.selections[0];
            const sel2 = gameState.selections[1];

            const value1 = sel1.num / sel1.den;
            const value2 = sel2.num / sel2.den;
            const dist1 = Math.abs(value1 - objective);
            const dist2 = Math.abs(value2 - objective);

            // Determinar ganador
            let winner = -1;
            let cardsWon = 4; // 2 cartas de cada jugador

            if (dist1 < dist2) {
                winner = 0;
            } else if (dist2 < dist1) {
                winner = 1;
            }
            // Si empate, winner = -1

            // Mostrar comparaci√≥n
            const compEl = document.getElementById('resultComparison');
            compEl.innerHTML = `
                <div class="result-player ${winner === 0 ? 'winner' : (winner === -1 ? 'tie' : 'loser')}">
                    <div class="result-player-name">${gameState.players[0]} ${winner === 0 ? 'üëë' : ''}</div>
                    <div class="result-fraction">${sel1.num}/${sel1.den}</div>
                    <div class="result-decimal">= ${value1.toFixed(3)}</div>
                    <div class="result-distance">Distancia: ${dist1.toFixed(3)}</div>
                </div>
                <div style="font-size: 2em;">‚öîÔ∏è</div>
                <div class="result-player ${winner === 1 ? 'winner' : (winner === -1 ? 'tie' : 'loser')}">
                    <div class="result-player-name">${gameState.players[1]} ${winner === 1 ? 'üëë' : ''}</div>
                    <div class="result-fraction">${sel2.num}/${sel2.den}</div>
                    <div class="result-decimal">= ${value2.toFixed(3)}</div>
                    <div class="result-distance">Distancia: ${dist2.toFixed(3)}</div>
                </div>
            `;

            // Anuncio del ganador
            const announceEl = document.getElementById('winnerAnnouncement');
            if (winner === -1) {
                announceEl.className = 'winner-announcement tie';
                announceEl.innerHTML = 'ü§ù ¬°Empate! Se reparten las cartas';
                gameState.scores[0] += 2;
                gameState.scores[1] += 2;
            } else {
                announceEl.className = 'winner-announcement win';
                announceEl.innerHTML = `üéâ ¬°${gameState.players[winner]} gana esta ronda!`;
                gameState.scores[winner] += cardsWon;
            }

            document.getElementById('cardsWon').textContent = `+${winner === -1 ? 2 : cardsWon} cartas`;

            // Quitar cartas usadas de las manos
            removeUsedCards(0);
            removeUsedCards(1);

            // Cambiar texto del bot√≥n si es √∫ltima ronda
            const nextBtn = document.getElementById('nextRoundBtn');
            if (gameState.currentRound >= 5) {
                nextBtn.textContent = 'üèÜ Ver resultados finales';
            } else {
                nextBtn.textContent = '‚û°Ô∏è Siguiente ronda';
            }
        }

        // Quitar cartas usadas
        function removeUsedCards(playerIndex) {
            const selection = gameState.selections[playerIndex];
            const hand = gameState.hands[playerIndex];

            // Eliminar en orden inverso para no afectar √≠ndices
            const indicesToRemove = [selection.numIndex, selection.denIndex].sort((a, b) => b - a);
            indicesToRemove.forEach(index => {
                hand.splice(index, 1);
            });
        }

        // Siguiente ronda
        function nextRound() {
            if (gameState.currentRound >= 5) {
                showFinalResults();
                return;
            }

            gameState.currentRound++;
            gameState.currentPlayer = 0;
            resetSelections();

            // Dar 2 cartas nuevas a cada jugador
            const newCards1 = dealCards(2);
            const newCards2 = dealCards(2);
            gameState.hands[0] = gameState.hands[0].concat(newCards1);
            gameState.hands[1] = gameState.hands[1].concat(newCards2);

            document.getElementById('roundResult').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'block';

            updateUI();
        }

        // Mostrar resultados finales
        function showFinalResults() {
            document.getElementById('roundResult').style.display = 'none';
            document.getElementById('finalScreen').style.display = 'block';

            const winner = gameState.scores[0] > gameState.scores[1] ? 0 :
                          gameState.scores[1] > gameState.scores[0] ? 1 : -1;

            const winnerEl = document.getElementById('finalWinner');
            if (winner === -1) {
                winnerEl.textContent = 'ü§ù ¬°Empate!';
            } else {
                winnerEl.textContent = `¬°${gameState.players[winner]} gana! üéâ`;
                createConfetti();
            }

            const scoresEl = document.getElementById('finalScores');
            scoresEl.innerHTML = `
                <div class="final-score-box ${winner === 0 ? 'winner' : ''}">
                    <div class="final-score-name">${gameState.players[0]}</div>
                    <div class="final-score-cards">${gameState.scores[0]} üÉè</div>
                </div>
                <div class="final-score-box ${winner === 1 ? 'winner' : ''}">
                    <div class="final-score-name">${gameState.players[1]}</div>
                    <div class="final-score-cards">${gameState.scores[1]} üÉè</div>
                </div>
            `;
        }

        // Crear confeti
        function createConfetti() {
            const colors = ['#667eea', '#764ba2', '#ffd54f', '#4caf50', '#e91e63', '#00bcd4'];
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                    confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                    document.body.appendChild(confetti);

                    setTimeout(() => confetti.remove(), 4000);
                }, i * 50);
            }
        }

        // Reiniciar juego
        function restartGame() {
            document.getElementById('finalScreen').style.display = 'none';
            document.getElementById('startScreen').style.display = 'block';
        }
    </script>
</body>
</html>
